<!DOCTYPE html>
<html>
	<head>
		<title>Testing page for websockets</title>
	</head>
	<body>
		<pre id="pre"></pre>
		<script>
			var e = document.getElementById('pre');

			var connect = function(linesToDrop) {
				var
					lineDropped = 0,
					socket = new WebSocket("ws://127.0.0.1:3000");

				socket.onclose = function(e) {
					console.log('socket closed: ', e);
					setTimeout(function() { connect(linesToDrop) }, 5000);
				};

				socket.onmessage = function(event) {
					if (++lineDropped > linesToDrop) {
						e.textContent += event.data + '\n';
					} else {
						console.log('drops: ', event.data)
					}
				};
			};

			connect(0);
		</script>
	</body>
</html>
